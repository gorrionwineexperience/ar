<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>GorriÃ³n Wine AR â€“ Triplico Seco</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

  <!-- A-Frame + AR.js (NFT tracking) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar-nft.js"></script>

  <style>
    html, body { margin:0; padding:0; overflow:hidden; background:#000; }
    #ui {
      position: fixed; left: 0; right: 0; bottom: 0;
      display:flex; justify-content:center; padding: 12px;
      pointer-events: none;
    }
    #playAudio {
      pointer-events: auto;
      padding: 10px 14px; border-radius: 10px; border: 0;
      background: rgba(255,255,255,.85);
      font-size: 14px; font-weight: 600; cursor: pointer;
    }
    #hint {
      position:fixed;left:0;right:0;top:0;text-align:center;padding:10px;
      color: #fff; font-size: 12px; opacity: .8;
      text-shadow: 0 1px 2px rgba(0,0,0,.7);
      pointer-events:none;
    }
  </style>
</head>
<body>
  <div id="ui">
    <button id="playAudio">ðŸ”Š Reproducir audio</button>
  </div>
  <div id="hint">Apunta la cÃ¡mara a la etiqueta de la botella Triplico Seco</div>

  <a-scene
    vr-mode-ui="enabled: false"
    embedded
    renderer="logarithmicDepthBuffer: true; antialias: true;"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
  >
    <a-assets timeout="10000">
      <img id="logo" src="assets/logo.png" crossorigin="anonymous" />
      <audio id="voice" src="assets/triplico.mp3" preload="auto"></audio>
    </a-assets>

    <a-nft
      id="marker"
      type="nft"
      url="assets/triplico"
      smooth="true"
      smoothCount="10"
      smoothTolerance="0.01"
      smoothThreshold="5"
    >
      <a-entity id="group" position="0 0 0" scale="0.001 0.001 0.001">

        <!-- Logo flotante -->
        <a-image
          src="#logo"
          position="0 1.2 0"
          width="1.4" height="1.4"
          opacity="0"
          animation="property: opacity; to: 1; dur: 800; easing: easeOutQuad; delay: 300"
        ></a-image>

        <!-- Panel de informaciÃ³n -->
        <a-entity position="0 0.2 0">
          <a-plane color="#000" opacity="0.65" width="2.2" height="1.2" radius="0.12"></a-plane>

          <a-text
            value="Triplico Multiplo 2023 â€“ Botter"
            color="#FFFFFF" align="center" width="2.0"
            position="0 0.38 0.01" opacity="0"
            animation="property: opacity; to: 1; dur: 600; delay: 250"
          ></a-text>

          <a-text
            value="Tipo: Tinto seco"
            color="#FFFFFF" align="center" width="2.0"
            position="0 0.15 0.01" opacity="0"
            animation="property: opacity; to: 1; dur: 600; delay: 350"
          ></a-text>

          <a-text
            value="Bodega: Botter"
            color="#FFFFFF" align="center" width="2.0"
            position="0 -0.05 0.01" opacity="0"
            animation="property: opacity; to: 1; dur: 600; delay: 450"
          ></a-text>

          <a-text
            value="Origen: Puglia, Italia"
            color="#FFFFFF" align="center" width="2.0"
            position="0 -0.25 0.01" opacity="0"
            animation="property: opacity; to: 1; dur: 600; delay: 550"
          ></a-text>

          <a-text
            value="Notas: frutos rojos maduros, especias suaves y taninos sedosos."
            color="#FFFFFF" align="center" width="2.0"
            position="0 -0.47 0.01" opacity="0"
            animation="property: opacity; to: 1; dur: 600; delay: 650"
          ></a-text>
        </a-entity>
      </a-entity>
    </a-nft>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const marker = document.getElementById('marker');
    const group = document.getElementById('group');
    const audio = document.getElementById('voice');
    const playBtn = document.getElementById('playAudio');

    audio.setAttribute('playsinline', '');
    audio.setAttribute('webkit-playsinline', '');

    let seen = false;

    function reveal() {
      group.setAttribute('animation__scale', {
        property: 'scale',
        to: '1 1 1',
        dur: 600,
        easing: 'easeOutCubic'
      });
    }

    marker.addEventListener('markerFound', async () => {
      if (!seen) { reveal(); seen = true; }
      try { await audio.play(); }
      catch { playBtn.style.display = 'inline-block'; }
    });

    marker.addEventListener('markerLost', () => { if (!audio.paused) audio.pause(); });

    playBtn.addEventListener('click', async () => {
      try {
        await audio.play();
        playBtn.style.display = 'none';
      } catch {
        alert('No se pudo reproducir el audio. Verifica permisos de sonido.');
      }
    });
  </script>
</body>
</html>
